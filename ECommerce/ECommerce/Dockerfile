#See https://aka.ms/containerfastmode to understand how Visual Studio uses this Dockerfile to build your images for faster debugging.

FROM mcr.microsoft.com/dotnet/core/aspnet:3.1-buster-slim AS base
WORKDIR /app
EXPOSE 80
EXPOSE 443

ARG ADMINEMAIL_ARG
ARG ADMINPASSWORD_ARG
ARG APILOGINID_ARG
ARG AUTHORIZELOGINID_ARG
ARG AUTHORIZETRANSACTIONKEY_ARG
ARG DISCOVER_ARG
ARG MASTERCARD_ARG
ARG STOREDBURL_ARG
ARG TESTCVV_ARG
ARG TESTEXPIRATIONDATE_ARG
ARG USERDBURL_ARG
ARG VISA_ARG

ENV ADMINEMAIL=$ADMINEMAIL_ARG
ENV ADMINPASSWORD=$ADMINPASSWORD_ARG
ENV APILOGINID=$APILOGINID_ARG
ENV AUTHORIZELOGINID=$AUTHORIZELOGINID_ARG
ENV AUTHORIZETRANSACTIONKEY=$AUTHORIZETRANSACTIONKEY_ARG
ENV DISCOVER=$DISCOVER_ARG
ENV MASTERCARD=$MASTERCARD_ARG
ENV STOREDBURL=$STOREDBURL_ARG
ENV TESTCVV=$TESTCVV_ARG
ENV TESTEXPIRATIONDATE=$TESTEXPIRATIONDATE_ARG
ENV USERDBURL=$USERDBURL_ARG
ENV VISA=$VISA_ARG

FROM mcr.microsoft.com/dotnet/core/sdk:3.1-buster AS build
WORKDIR /src
COPY ["ECommerce.csproj", "./"]
RUN dotnet restore "./ECommerce.csproj"
COPY . .
WORKDIR "/src/."
RUN dotnet build "ECommerce.csproj" -c Release -o /app/build

FROM build AS publish
RUN dotnet publish "ECommerce.csproj" -c Release -o /app/publish

FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
CMD ASPNETCORE_URLS=http://*:$PORT dotnet ECommerce.dll
